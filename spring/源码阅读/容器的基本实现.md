# Spring容器的基本实现

## 核心类介绍

### 1、DefaultListableBeanFactory

​	XmlBeanFactory继承自DefaultListableBeanFactory，而DefaultListableBeanFactory是整个加载的核心部分，是Spring注册及加载bean的默认实现，而XmlBeanFactory和DefaultListableBeanFactory不同的地方其实是XmlBeanFactory中使用了自定义的XML读取器XmlBeanDefinitionReader，实现了个性化的BeanDefinitionReader读取，DefaultListableBeanFactory继承了AbstractAutowireCapableBeanFactory并实现了ConfigurableListableBeanFactory以及BeanDefinitionRegistry接口。

​	DefaultListableBeanFactory类的继承机构及各个类的作用：

![1553521431252](E:\kaikeba\wjy\spring\源码阅读\assets\1553521431252.png)

AliasRegistry：定义对alias的简单增删改等操作。

SimpleAliasRegistry：主要使用map作为alias的缓存，并对接口AliasRegistry进行实现。

SingletonBeanRegistry：定义对单例的注册及获取。

BeanFactory：定义获取bean及bean的各种属性。

DefaultSingletonBeanRegistry：对接口SingletonBeanRegistry各函数的实现。

HierarchicalBeanFactory：继承BeanFactory，也就是在BeanFactory定义的功能的基础上增加了对parentFactory的支持。

BeanDefinitionRegistry：定义对BeanDefinition的各种增删改操作。

FactoryBeanRegistrySupport：在DefaultSingletonBeanRegistry基础上增加了对FactoryBean的特殊处理功能。

ConfigurableBeanFactory：提供配置Factory的各种方法。

ListableBeanFactory：根据各种条件获取bean的配置清单。

AbstractBeanFactory：综合FactoryBeanRegistrySupport和ConfigurableBeanFactory的功能。

AutowireCapableBeanFactory：提供创建bean、自动注入、初始化以及应用bean的后处理器。

AbstractAutowireCapableBeanFactory：综合AbstractBeanFactory并对接口AutowireCapableBeanFactory进行实现。

ConfigurableListableBeanFactory：BeanFactory配置清单，指定忽略类型及接口等。

DefaultListableBeanFactory：综合上面所有功能，主要是对bean注册后的处理。

​	XmlBeanFactory对DefaultListableBeanFactory类进行扩展，主要用于XML文档中读取BeanDefinition，对于注册及获取Bean都是使用父类DefaultListableBeanFactory继承的方法实现，而唯独与父类不同的个性化实现就是增加了XmlBeanDefinitionReader类型的reader属性。在XmlBeanFactory中主要使用reader属性对资源文件进行读取和注册。

### 2、XmlBeanDefinitionReader

![1553561609619](E:\kaikeba\wjy\spring\源码阅读\assets\1553561609619.png)

ResourceLoader：定义资源加载器，主要应用于根据给定的资源文件地址返回对应的Resource。

BeanDefinitionReader：主要定义资源文件读取并转换为BeanDefinition的各个功能。

EnviromentCapable：定义获取Environment方法。

DocumentLoader：定义从资源文件加载到转换为Document的功能。

AbstractBeanDefinitionReader：对EnviromentCapable、BeanDefinitionReader类定义的功能进行实现。

BeanDefinitionDocumentReader：定义读取Document并注册BeanDefinition功能。

BeanDefinitionParserDelegate：定义解析Element的各种方法。

整个XML配置文件的读取大致流程：

+ 通过继承自AbstractBeanDefinitionReader中的方法，来使用ResourceLoader将资源文件路径转换为对应的Resource文件。
+ 通过DocumentLoader对Resource文件进行转换，将Resource文件转换为Document文件。
+ 通过实现接口BeanDefinitionDocumentReader的DefaultBeanDefinitionDocumentReader类对Document进行解析，并使用BeanDefinitionParserDelegate对Element进行解析。

## 容器的基础XmlBeanFactory

